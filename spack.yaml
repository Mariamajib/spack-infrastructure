spack:
  view: false
  config:
    install_tree:
      root: $spack
      padded_length: 127
    build_stage: $spack/spack-stage
    misc_cache: $spack/misc_cache
  mirrors:
    perlmutter-e4s-21.05: /global/common/software/spackecp/mirrors/perlmutter-e4s-21.05
  definitions:
  
          #- cuda_specs_nvhpc:
          #- ascent@0.7.1  ~shared
          #- magma@2.5.4
          #- raja@0.13.0

    # amrex can't built with nvhpc
    #- amrex@21.05 +cuda cuda_arch=80
    # kokkos not supported by nvhpc compiler
    #- kokkos@3.4.00
    #- kokkos-kernels@3.2.00
    #- caliper@2.5.0
    # cant build chai and umpire with nvhpc
    #  - chai@2.3.0 ~benchmarks
    #  - umpire@4.1.2
  - nvhpc_specs:
    - gasnet@2021.3.0
    #- superlu@5.2.1

    #- petsc@3.15.0
  #- gcc_cuda_specs:
    # issue building blaspp  -- Detecting CXX compiler ABI info - failed
    # - slate@2021.05.02
    #- openmpi@4.0.5 +cuda

  - gcc_specs:
    - aml@0.1.0
    - adios2
    - amrex@21.02 +openmp +fortran
    - arborx@1.0 +openmp
    # issue building llvm
    #- archer@2.0.0
    - argobots@1.1
    # Failed to find conduit fortran module.  Ascent Fortran support requires
    #- ascent@0.7.1
    # skip axom for now
    #- axom@0.5.0
    - bolt@2.0
    - cabana@0.3.0
    - chai@2.3.0 ~benchmarks ~tests
    - conduit@0.7.2
    - darshan-runtime@3.3.0
    - darshan-util@3.3.0
    - hdf5@1.10.7
    # issue installing fftw support: /usr/bin/ld: /opt/cray/pe/fftw/3.3.8.9/x86_rome/lib/libfftw3f_mpi.so: undefined reference to `MPI_Bcast'  
    #- heffte@2.0.0 +fftw +fortran
    - hypre@2.20.0 +openmp
    - faodel@1.1906.1
    - ginkgo@1.3.0
    - globalarrays@5.8
    - gotcha@1.0.3
    - kokkos@3.4.00
    - kokkos-kernels@3.2.00
    - legion@21.03.0 +hdf5 +openmp
    - libnrm@0.1.0
    - metall@0.13
    # skip mfem for now
    #- mfem@4.2.0
    - ninja@1.10.2
    - openpmd-api@0.13.4
    - openmpi@4.0.5
    - papi@6.0.0.1
    - papyrus@1.0.1
    # issue installing openblas 
    # No package 'mpich' found
    # make: *** [Makefile.prebuild:70: getarch] Error 1
    # Makefile.system:255: Makefile.conf: No such file or directory
    # make: *** No rule to make target 'Makefile.conf'.  Stop.

    #- plasma@20.9.20 ^openblas
    - pumi@2.2.5 +fortran +shared
    - pdt@3.25.1
    - qthreads@1.16 scheduler=distrib
    - raja@0.13.0
    # configure: error: Failed to find C MPI Wrapper.
    #- rempi@1.1.0
    - slepc@3.15.0
    - superlu@5.2.1
    - superlu-dist@6.4.0 +openmp
    - sundials@5.7.0
    - tau@2.30.1

    - unifyfs@0.9.1
    # configure error: User requested --enable-aries but I don't know how to build aries programs for your system
    #- upcxx@2021.3.0
  - nvhpc: ['%nvhpc@21.5']
  - gcc: ['%gcc@10.2.0']
  specs:
  
          #- matrix:
          # - [$cuda_specs_nvhpc]
          # - [+cuda cuda_arch=80]
          #- [^cmake%gcc]
          #- [^python%gcc]
          #- [$nvhpc]
  - matrix:
    - [$nvhpc_specs]
    - [^cmake%gcc]
    - [$nvhpc]
  - matrix:
    - [$gcc_specs]
    - [$gcc]
      #- matrix:
      #- [$gcc_cuda_specs]
      #- [$gcc]
  compilers:
  - compiler:
      spec: gcc@10.3.0
      paths:
        cc: cc
        cxx: CC
        f77: ftn
        fc: ftn
      operating_system: sles15
      modules:
      - PrgEnv-gnu
      - gcc/10.3.0
  - compiler:
      spec: nvhpc@21.5
      paths:
        cc: cc
        cxx: CC
        f77: ftn
        fc: ftn
      operating_system: sles15
      modules:
      - PrgEnv-nvidia
      - nvidia-nersc/21.5

  packages:
    all:
      providers:
        compiler: [nvhpc@21.5, gcc@10.3.0]
        mpi: [mpich]
        fftw: [cray-fftw]
        blas: [cray-libsci]
        scalapack: [cray-libsci]
        pkgconfig: [pkg-config]
    bzip2:
      version: [1.0.6]
      buildable: false
      externals:
      - spec: bzip2@1.0.6
        prefix: /usr
    cray-libsci:
      buildable: false
      externals:
      - spec: cray-libsci@20.06.1
        modules:
        - cray-libsci/21.06.1.1
    cuda:
      buildable: false
      externals:
      - spec: cuda@11.3.0
        modules:
        - PrgEnv-nvidia
        - nvidia-nersc/21.5
    diffutils:
      version: [3.6]
      buildable: false
      externals:
      - spec: diffutils
        prefix: /usr
    cray-fftw:
      version: [3.3.8.8]
      buildable: false
      externals:
      - spec: cray-fftw@3.3.8.8
        modules:
        - cray-fftw/3.3.8.10
    hdf5:
      variants: +cxx +fortran
    gettext:
      version: [0.19.8.1]
      buildable: false
      externals:
      - spec: gettext
        prefix: /usr
    libfabric:
      buildable: false
      externals:
      - spec: libfabric@1.11.0
        modules:
        - libfabric/1.11.0.4.71
    mpich:
      buildable: false
      externals:
      - spec: mpich@3.4
        modules:
        - cray-mpich/8.1.7
    m4:
      buildable: false
      externals:
      - spec: m4@1.4.18
        prefix: /usr
    openssl:
      buildable: false
      externals:
      - spec: openssl@1.1.1k
        prefix: /usr
    openssh:
      version: [7.9p1]
      buildable: false
      externals:
      - spec: openssh
        prefix: /usr
    openmpi:
      version: [4.0.5]
      variants: +cxx schedulers=slurm
    perl:
      version: [5.31.7]
    slurm:
      buildable: false
      version: [20-11-5-1]
      externals:
      - spec: slurm
        prefix: /usr
    tar:
      version: [1.3]
      buildable: false
      externals:
      - spec: tar@1.30
        prefix: /usr
      - spec: tar@1.30
        prefix: /usr
