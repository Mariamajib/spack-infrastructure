spack:
  view: false
  config:
    install_tree:
      root: /global/common/software/spackecp/perlmutter/e4s-21.08/software
    module_roots:
      lmod: /global/common/software/spackecp/perlmutter/e4s-21.08/modules
    build_stage: $tempdir/spack-stage
    misc_cache: $tempdir/misc_cache
  mirrors:
    perlmutter-e4s-21.08: /global/common/software/spackecp/mirrors/perlmutter-e4s-21.08
  modules:
    enable::
      - lmod
    lmod:
    core_compilers:
      - 'gcc@11.2.0'
      - 'nvhpc@21.7'  
    hierarchy:
      - mpi
    hash_length: 0
    all:
      environment:
        set:
          - '{name}_ROOT': '{prefix}'

  definitions:
  - cuda_specs:
    
    #- amrex@21.10 +openmp +pic +shared +cuda cuda_arch=80
    #- caliper@2.6.0 +cuda cuda_arch=80
    #- chai@2.3.0 +cuda ~benchmarks ~tests cuda_arch=80 ^umpire@4.1.2 ~shared concretization issue
    #- ginkgo@1.3.0 +cuda cuda_arch=80
    # - hpx@1.7.1 +cuda cuda_arch=80
    #- hypre@2.22.0 +cuda cuda_arch=80
    #- magma@2.6.1 +cuda cuda_arch=80


    #- mfem@4.3.0 +cuda cuda_arch=80
    #    - parsec@3.0.2012 +cuda cuda_arch=80
    # - raja@0.13.0 +cuda cuda_arch=80 see issue https://github.com/spack/spack/issues/26995
    #- slate +cuda cuda_arch=80


    #- strumpack +cuda ~slate cuda_arch=80
    # - sundials +cuda cuda_arch=80
    #- superlu-dist@6.4.0 +cuda cuda_arch=80
    #- umpire@4.1.2 +cuda ~shared cuda_arch=80
    - zfp@0.5.5 +cuda cuda_arch=80

  - gcc_cuda_specs: []
  
     #- magma@2.6.1 +cuda cuda_arch=80 
     #- raja@0.13.0 +cuda cuda_arch=80  #  issue installing dep  camp- Could NOT find CUDA (missing: CUDA_INCLUDE_DIRS CUDA_CUDART_LIBRARY)
      #- slate +cuda cuda_arch=80
      #- sundials +cuda cuda_arch=80 unsupported GNU version! gcc versions later than 9 are not supported!
      #- superlu-dist@6.4.0 +cuda cuda_arch=80 unable to build parmetis

  - e4s_specs:
    - adios2@2.7.1 ~dataman
    - aml@0.1.0
















    
    #- amrex@21.08 fails to find cray-libsci header files
    # - arborx@1.0 failed install
    - argobots@1.1
















    
    #- ascent@0.7.1 build failed
    #- bolt@2.0
    - darshan-runtime@3.3.1 scheduler=slurm ~mpi
    - darshan-util@3.3.1
















    
    #- dyninst@11.0.1 problem installing elfutils
    #- flecsi@1.4.2 issue building parmetis
    - flit@2.1.0


    
    #- flux-core@0.28.0  /usr/bin/ld: /tmp/spack/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_/cray-sles15-zen3/gcc-11.2.0/libzmq-4.3.3-sbpscdx5msmvwp3sjdifj7s4mqnjwmw3/lib/libzmq.so: undefined reference to `std::__throw_bad_array_new_length()@@GLIBCXX_3.4.29'
    #- flux-core@0.30.0

    #- fortrilinos@2.0.0 skip for now
    - gasnet@2021.3.0
















    
    # - geopm@1.1.0 skip for now
    - ginkgo@1.3.0
    - hdf5@1.12.0 ~mpi
















    
    #- heffte@2.1.0 +fftw build failure on fftw
    #- hpctoolkit@2021.05.15 depends on dyninst which failed
    #- hypre@2.22.0
    #- kokkos@3.4.00 +openmp #see https://github.com/spack/spack/issues/26950
    # - kokkos-kernels@3.2.00 +openmp
    - legion@21.03.0
    - metall@0.15



















    
    #- mfem@4.3.0 install failed
    #- netlib-scalapack@2.1.0 build failure
    # - omega-h@9.32.5 install failed
    - openmpi@4.1.1
    - papi@6.0.0.1



















    
    #- papyrus@1.0.1 could not find MPI libraries
    # - parallel-netcdf@1.12.2 Skip package 
    #- paraview@5.9.1 install failed
      #- parsec@3.0.2012 ~cuda failed install
    #- petsc@3.15.3 ~hypre ~hdf5 build fail
    - qthreads@1.16 scheduler=distrib
    - raja@0.13.0



















    
    #- rempi@1.1.0 build fail
    #- scr@3.0rc1
    - slate@2021.05.02 ~cuda ~mpi



















    
    #- strumpack@5.1.1 ~slate build failure
    #- sundials@5.7.0 build failure
    - superlu@5.2.2



















    
    #- superlu-dist@6.4.0 +openmp build failure
    - swig@4.0.2
    - swig@4.0.2-fortran
    - sz@2.1.12 +fortran



















    
     #- trilinos@13.0.1 +amesos +amesos2 +anasazi +aztec +belos +boost +epetra +epetraext +ifpack +ifpack2 +intrepid +intrepid2 +isorropia +kokkos +ml +minitensor +muelu +nox +piro +phalanx +rol +rythmos +sacado +stk +shards +shylu +stokhos +stratimikos +teko +tempus +tpetra +trilinoscouplings +zoltan +zoltan2 +superlu-dist gotype=long_long
    - umap@2.1.0
    - umpire@4.1.2 +openmp



















    
    #- unifyfs@0.9.1 failed to find MPI 
    #- upcxx@2021.3.0 build failed
    #- veloc@1.4 build failed
    - vtk-m@1.6.0
    - zfp@0.5.5
  - aux_specs:
    
    #- axom@0.5.0 ^umpire@4.1.2 failed to install conduit
    #- conduit@0.7.2 ~hdf5 ~mpi build failure
    - faodel@1.1906.1 ~mpi



















    
    #- globalarrays@5.8 failed configure: error: could not link simple Fortran MPI program
    - gotcha@1.0.3
    - hpx@1.7.1
    - libnrm@0.1.0



















    
    #- libquo@1.3.1  configure: error: *** CC cannot compile MPI apps. set CC to something that can or set CPPFLAGS and LDFLAGS appropriately
    #- loki@0.1.7 ../include/loki/SmallObj.h:462:57: error: ISO C++17 does not allow dynamic exception specifications
    - mercury@2.0.1
    - mpark-variant@1.4.0



















    
    #- mpifileutils@0.11 ~xattr failed to build libcircle
    - ninja@1.10.2
    - openpmd-api@0.13.4 ~hdf5
    - pdt@3.25.1



















    
    #- phist@1.9.4 build failed on MPI_Allreduce
    #- plasma@20.9.20 failed to find blas libraries
    - precice@2.2.1 ~petsc ~mpi



















    
    #- pumi@2.2.6 build failed
    - py-warpx@21.08 ~mpi ^warpx~mpi dims=2 ^fftw~mpi
    - py-warpx@21.08 ~mpi ^warpx~mpi dims=3 ^fftw~mpi
    - py-warpx@21.08 ~mpi ^warpx~mpi dims=rz ^fftw~mpi



















    
    #- slepc@3.15.1 ~arpack unable to build petsc 
    - stc@0.9.0
    - turbine@1.3.0
    - warpx~mpi dims=rz ^fftw~mpi
    - warpx~mpi dims=2 ^fftw~mpi
    - warpx~mpi dims=3 ^fftw~mpi

  - compilers: ['%nvhpc@21.7', '%gcc@11.2.0']
  specs:
  - matrix:
    - [$cuda_specs]
    - ['%nvhpc']
    - [^cmake%gcc]
  - matrix:
    - [$e4s_specs]
    - ['%gcc@11.2.0']
  - matrix:
    - [$gcc_cuda_specs]
    - ['%gcc@11.2.0']
  #- matrix:
  #  - [$e4s_specs, $cuda_specs]
  #  - [$compilers]
  #  - [^nvhpc, ^cray-libsci]
  #  exclude:
  #    - '%gcc ^nvhpc'
  #    - '%nvhpc ^cray-libsci'  
  - matrix:
    - [$aux_specs]
    - ['%gcc@11.2.0']
  compilers:
  - compiler:
      spec: gcc@10.3.0
      paths:
        cc: /opt/cray/pe/gcc/10.3.0/bin/gcc
        cxx: /opt/cray/pe/gcc/10.3.0/bin/g++
        f77: /opt/cray/pe/gcc/10.3.0/bin/gfortran
        fc: /opt/cray/pe/gcc/10.3.0/bin/gfortran
      operating_system: sles15
      modules:
      - PrgEnv-gnu/8.1.0
      - gcc/10.3.0
  - compiler:
      spec: gcc@11.2.0
      paths:
        cc: /opt/cray/pe/gcc/11.2.0/bin/gcc
        cxx: /opt/cray/pe/gcc/11.2.0/bin/g++
        f77: /opt/cray/pe/gcc/11.2.0/bin/gfortran
        fc: /opt/cray/pe/gcc/11.2.0/bin/gfortran
      operating_system: sles15
      modules:
      - PrgEnv-gnu/8.1.0
      - gcc/11.2.0
  - compiler:
      spec: nvhpc@21.7
      paths:
        cc: /opt/nvidia/hpc_sdk/Linux_x86_64/21.7/compilers/bin/nvc
        cxx: /opt/nvidia/hpc_sdk/Linux_x86_64/21.7/compilers/bin/nvc++
        f77: /opt/nvidia/hpc_sdk/Linux_x86_64/21.7/compilers/bin/nvfortran
        fc: /opt/nvidia/hpc_sdk/Linux_x86_64/21.7/compilers/bin/nvfortran
      modules:
      - nvhpc-nompi/21.7
      flags: {}
      operating_system: sles15
      target: any
      environment: {}
      extra_rpaths: []
  packages:
    all:
      providers:
        compiler: [gcc@11.3.0, nvhpc@21.7]
        mpi: [cray-mpich]
        fftw-api: [cray-fftw]
        blas: [cray-libsci, nvhpc]
        scalapack: [cray-libsci]
        pkgconfig: [pkg-config]
    amrex:
      variants: +openmp +pic +fortran
    automake:
      version: [1.16.3]
    bzip2:
      version: [1.0.6]
      buildable: false
      externals:
      - spec: bzip2@1.0.6
        prefix: /usr
    cray-mpich:
      buildable: false
      externals:
      - spec: cray-mpich@8.1.0
        prefix: /opt/cray/pe/mpich/8.1.9/ofi/GNU/9.1/
        modules:
        - cray-mpich/8.1.9
    cray-libsci:
      buildable: false
      externals:
      - spec: cray-libsci@20.06.1
        prefix: /opt/cray/pe/libsci/21.08.1.2/GNU/9.1/x86_64/
        modules:
        - cray-libsci/21.08.1.2
    cuda:
      buildable: false
      version: [11.4.0]
      externals:
      - spec: cuda@11.4.0%gcc
        modules:
        - PrgEnv-gnu
        - nvhpc-nompi/21.7
    diffutils:
      version: [3.6]
      buildable: false
      externals:
      - spec: diffutils@3.6
        prefix: /usr
    cray-fftw:
      version: [3.3.8.8]
      buildable: false
      externals:
      - spec: cray-fftw@3.3.8.8
        modules:
        - cray-fftw/3.3.8.11
    hdf5:
      variants: +cxx +fortran ~mpi
    gettext:
      version: [0.19.8.1]
      buildable: false
      externals:
      - spec: gettext
        prefix: /usr
    git:
      version: [2.26.2]
      buildable: false
      externals:
      - spec: git@2.26.2
        prefix: /usr
    libfabric:
      buildable: false
      externals:
      - spec: libfabric@1.11.0
        modules:
        - libfabric/1.11.0.4.79
    m4:
      buildable: false
      externals:
      - spec: m4@1.4.18
        prefix: /usr
   #nvhpc:
   #   buildable: false
   #   externals:
   #   - spec: nvhpc@21.7
   #     modules:
   #     - nvhpc/21.7
    openssl:
      buildable: false
      externals:
      - spec: openssl@1.1.1k
        prefix: /usr
    openssh:
      version: [7.9p1]
      buildable: false
      externals:
      - spec: openssh
        prefix: /usr
    openmpi:
      version: [4.0.5]
      variants: +cxx schedulers=slurm
    pdsh:
      buildable: false
      externals:
      - spec: pdsh@2.31
        prefix: /usr
    petsc:
      variants: ~hypre ~hdf5 ~metis ~superlu-dist ~mpi
    python:
      buildable: false
      externals:
      - spec: python@3.8.8
        modules:
        - python/3.9-anaconda-2021.05
    slurm:
      buildable: false
      version: [20-11-5-1]
      externals:
      - spec: slurm
        prefix: /usr
    tar:
      version: [1.3]
      buildable: false
      externals:
      - spec: tar@1.30
        prefix: /usr
    unzip:
      version: [6.0]
      buildable: false
      externals:
      - spec: unzip@6.0
        prefix: /usr
    zsh:
      version: [5.6]
      buildable: false
      externals:
      - spec: zsh@5.6
        prefix: /usr
