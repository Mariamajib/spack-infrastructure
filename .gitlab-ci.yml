variables:
  SPACK_REPO: https://github.com/spack/spack.git
stages:
  - build

perlmutter-spack-develop:
  stage: build
  tags: [perlmutter-login21]
  only:
    refs:
      - schedules
    variables:
      - $SPACK_DEVELOP == "True"
  script:
    - export SPACK_DISABLE_LOCAL_CONFIG=true
    - git clone $SPACK_REPO
    - . spack/share/spack/setup-env.sh
    - cd $CI_PROJECT_DIR
    - spack env activate -d spack-configs/perlmutter-spack-develop
    - spack concretize --reuse
    - spack install --reuse
    - spack find

perlmutter-e4s-21.11-ci:
  stage: build
  tags: [perlmutter-login21]
  only:
    refs:
      - schedules
    variables:
      - $E4S_21.11_CI == "True"
      - $SYSTEM == "Perlmutter"
  script:
    - export SPACK_DISABLE_LOCAL_CONFIG=true
    - git clone -b e4s-21.11 $SPACK_REPO 
    - . spack/share/spack/setup-env.sh
    - cd $CI_PROJECT_DIR
    - spack env activate -d spack-configs/perlmutter-e4s-21.11/ci
    - spack concretize
    - spack install 
    - spack find

